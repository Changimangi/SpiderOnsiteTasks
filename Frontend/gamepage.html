<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="gamepage.css">
</head>
<body onload="start()">
    


    <script>
        var myinsects = [];
        var score = 0;
        var clickx = undefined;
        var clicky = undefined;
        var nleft = 0;

        window.addEventListener("resize",function(){
            gameArea.render();
        })

        function start(){
            console.log("started")
            gameArea.begin();
        }

        gameArea = {
            canvas : document.createElement("canvas"),
            begin : function(){
                console.log("began")
                this.context = this.canvas.getContext("2d");
                this.canvas.width = document.documentElement.clientWidth;
                this.canvas.height = document.documentElement.clientHeight;
                document.body.insertBefore(this.canvas,document.body.childNodes[0])
                setInterval(update,1)
                setInterval(createinsects,1000)
            },
            render:function(){
                gameArea.context.fillRect(0,0,gameArea.context.width,gameArea.context.height);
                this.canvas.width = document.documentElement.clientWidth;
                this.canvas.height = document.documentElement.clientHeight;

            } 
        }

        document.addEventListener("click",(e) => {
            const {clientX,clientY} = e;
            clickx = clientX;
            clicky = clientY;
            console.log(clientX + " "+ clientY)
        })

        function insects(x,y,r){
            this.x = x;
            this.y = y;
            this.r = r;
            let img = new Image();
            img.src = "insect.png";
            gameArea.context.drawImage(img,x,y,r,r);
        }

        function createinsects(){
            let posx;
            posx = Math.floor(Math.random()*(document.documentElement.clientWidth-200))+70;
            myinsects.push(new insects(posx,document.documentElement.clientHeight,50))
        }

        function update(){
            gameArea.context.clearRect(0,0,gameArea.canvas.width,gameArea.canvas.height)
            moveinsects();
            checkdisp();
            for( let i = 0; i<myinsects.length; i++){
                myinsects[i] = new insects(myinsects[i].x,myinsects[i].y,myinsects[i].r);
            }
            
        }

        function moveinsects(){
            for( let i = 0; i<myinsects.length; i++){
                let yc = myinsects[i].y
                yc--;
                myinsects[i].y = yc; 
            }
        }

        function checkdisp(){
            for( let i = 0; i<myinsects.length; i++){
                console.log("clicks:"+clickx + " "+clicky)
                if(clickx!=undefined && clicky !=undefined && clickx>=myinsects[i].x && clickx<=myinsects[i].x+myinsects[i].r && clicky>=myinsects[i].y&& clicky<=myinsects[i].y+myinsects[i].r){
                    myinsects.splice(i,1);
                    score+=500;
                    clickx = undefined;
                    clicky = undefined
                }
                else if(myinsects[i].y<=0){
                    myinsects.splice(i,1)
                    nleft++;
                }
                
            }
            if(nleft>=15){
                location.href = "score.html?score="+score;
            }
            
        }


    </script>
</body>
</html>